<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Simulateur 3D â€” FIX Render</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body { margin:0; background:#111; color:#fff; font-family:Arial; }
    #sim_container { width:100%; height:600px; background:#000; }
    #log { padding:10px; font-size:14px; white-space:pre-wrap; }
  </style>
</head>
<body>

<h2 style="padding:10px">Simulateur 3D â€” FIX Render</h2>
<div id="sim_container"></div>
<div id="log"></div>

<script>
function log(t){
  document.getElementById("log").textContent += t + "\n";
  console.log(t);
}
</script>

<!-- THREE.js (OK partout) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r152/three.min.js"></script>

<!-- ðŸŸ¢ CANNON: VERSION UMD 100% COMPATIBLE RENDER -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/cannon/0.6.2/cannon.min.js"
        onload="log('CANNON UMD chargÃ©')"
        onerror="log('âŒ Cannon UMD ne se charge pas')"></script>

<script>
// Attendre que Cannon et Three soient prÃªts
function waitReady(){
  if(!window.THREE){ return log("THREE pas prÃªt..."); }
  if(!window.CANNON){ return log("CANNON pas prÃªt..."); }
  startSim();
}
setTimeout(waitReady, 500);

// ----------- SIMULATION -------------
let scene, camera, renderer, world, robots=[];

function startSim(){
  log("DÃ©marrage simulationâ€¦");

  const container = document.getElementById("sim_container");

  // THREE.js
  scene = new THREE.Scene();
  camera = new THREE.PerspectiveCamera(60, container.clientWidth/container.clientHeight, 0.1, 1000);
  camera.position.set(6,4,6);
  camera.lookAt(0,0,0);

  renderer = new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(container.clientWidth, container.clientHeight);
  renderer.setClearColor(0x111111);
  container.appendChild(renderer.domElement);

  // LumiÃ¨res
  scene.add(new THREE.AmbientLight(0xffffff, 0.8));
  const d = new THREE.DirectionalLight(0xffffff,1);
  d.position.set(10,10,5);
  scene.add(d);

  // Sol
  const floor = new THREE.Mesh(
    new THREE.PlaneGeometry(40,40),
    new THREE.MeshStandardMaterial({color:0x303030})
  );
  floor.rotation.x = -Math.PI/2;
  scene.add(floor);

  // Physique Cannon
  world = new CANNON.World();
  world.gravity.set(0,-9.82,0);

  const groundBody = new CANNON.Body({ mass:0 });
  groundBody.addShape(new CANNON.Plane());
  groundBody.quaternion.setFromEuler(-Math.PI/2,0,0);
  world.addBody(groundBody);

  // Un robot
  addRobot(0,1,0);
  addRobot(2,1,0);
  addRobot(-2,1,0);

  animate();
}

function addRobot(x,y,z){
  const geo = new THREE.BoxGeometry(1,1,1);
  const mat = new THREE.MeshStandardMaterial({color:Math.random()*0xffffff});
  const mesh = new THREE.Mesh(geo,mat);
  mesh.position.set(x,y,z);
  scene.add(mesh);

  const body = new CANNON.Body({
    mass:1,
    shape: new CANNON.Box(new CANNON.Vec3(0.5,0.5,0.5))
  });
  body.position.set(x,y,z);
  world.addBody(body);

  robots.push({mesh,body});
  return robots.length-1;
}

function animate(){
  requestAnimationFrame(animate);
  world.step(1/60);

  robots.forEach(r=>{
    r.mesh.position.copy(r.body.position);
    r.mesh.quaternion.copy(r.body.quaternion);
  });

  renderer.render(scene,camera);
}
</script>

</body>
</html>